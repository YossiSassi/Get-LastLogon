$Account = Read-Host "Enter samaccountname (e.g. administrator, or SRV01$)"; $DN=([adsi]'').distinguishedname; $DCs = ([adsisearcher]"(&(objectCategory=computer)(userAccountControl:1.2.840.113556.1.4.803:=8192))").FindAll().Properties.dnshostname; $results=@(); $EAP=$ErrorActionPreference; $ErrorActionPreference="silentlycontinue"; $DCs | % {$dc=$_; $root=[adsi]"LDAP://$dc/$DN"; $Obj=New-Object System.DirectoryServices.DirectorySearcher -ArgumentList $root; $Obj.Filter= "samaccountname=$Account"; $AccountObj = $Obj.FindOne(); if ($AccountObj) {[datetime]$res=[datetime]::FromFileTime($($AccountObj.Properties.lastlogon)); "$DC - $res";$results+=$res} else {write-host "[!] No result found. Check that the samaccountname is correct." -fore yellow}}; Write-Host "[*] Last Logon for $($Account.ToUpper()) ($($AccountObj.Properties.cn)): $($results | sort | select -Last 1)" -ForegroundColor Cyan; remove-variable account,accountobj,results,obj,res; $ErrorActionPreference = $EAP;
# TIP: use this LoTL powershell oneliner to FIND the samaccountname of a user, based on free text search/indexed name resolution on AD objects:
# ([adsisearcher]"(anr=sassi)").FindAll() | % {"$($_.Properties.cn):$($_.Properties.samaccountname)"}